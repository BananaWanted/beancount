#!/usr/bin/env python3
"""
Measure the time it takes to parse, check and realize an input file.
"""
import argparse
import itertools

import beancount2.parser
from beancount2 import checks
from beancount2 import utils
from beancount2 import data
from beancount2 import realization


def main():
    parser = argparse.ArgumentParser(__doc__.strip())
    parser.add_argument('filename',
                        help='Beancount input filename.')
    opts = parser.parse_args()

    with utils.print_time('parse'):
        contents = beancount2.parser.parse(opts.filename)

    with utils.print_time('check'):
        check_errors = checks.check(contents.entries, contents.accounts)

    with utils.print_time('realize'):
        accounts_tree, real_errors = realization.realize(contents.entries, check=True)

    if 0:
        for error in itertools.chain(contents.parse_errors, check_errors, real_errors):
            print('{} {}'.format(data.render_fileloc(error.fileloc), error.message))


if __name__ == '__main__':
    main()
